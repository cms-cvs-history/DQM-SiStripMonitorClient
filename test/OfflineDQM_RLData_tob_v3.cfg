process OfflineDQMSiStripRecoDigisClusters = {

  #=========================================================================================
  # MessageLogger
    service = MessageLogger {
      untracked vstring suppressInfo = {"siStripClusters","siStripClusters325"}

      untracked vstring destinations =
      {
	"cout", "cerr"
      }
      untracked vstring categories =
      {
	"FwkJob",
	"FwkReport",
	"Root_NoDictionary"
      }
      untracked PSet cout =
      {
	untracked string threshold = "INFO"
	untracked PSet default =
	{
	  untracked int32 limit       = 1000000000
	  untracked int32 reportEvery = 1
	}
	untracked PSet FwkJob =
	{
	  untracked int32 limit       = 1000000000
	  untracked int32 reportEvery = 1000
	}
	untracked PSet FwkReport =
	{
	  untracked int32 limit       = 1000000000
	  untracked int32 reportEvery = 1000
	}
      }
      untracked PSet cerr = { untracked string threshold = "ERROR" }
    }  
  # End MessageLogger
  #=========================================================================================

  #=========================================================================================
  # Sources
    source = PoolSource {
      untracked vstring fileNames =  {
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_000.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_001.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_002.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_003.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_004.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_005.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_006.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_007.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_008.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_009.root",
	"file:/uscmst1b_scratch/lpc1/cmsroc/TAC/EDM0002048_010.root"
       }

      untracked uint32 debugVebosity = 1
      untracked bool debugFlag       = true
    }
    untracked PSet maxEvents = {untracked int32 input = -1}
  # End Sources
  #=========================================================================================
  
  #=========================================================================================
  # Modules Configuration
    # > Magnetic Field <
      include "MagneticField/Engine/data/uniformMagneticField.cfi"
      replace UniformMagneticFieldESProducer.ZFieldInTesla = 0
    
    # > Geometry <
      include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
      include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

      include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

    # > Cabling and Pedestals <
      # read cabling and pedestals from DB
    es_source = PoolDBESSource {
      VPSet toGet = {
#        { string record = "SiStripPedestalsRcd" string tag = "SiStripPedNoise_TIBTOB_v1_p"},
        { string record = "SiStripNoisesRcd" string tag = "SiStripPedNoise_TIBTOB_v1_n"},
        { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_TIBTOB_v1"}}

      bool loadAll = true
      string connect = "frontier://cms_conditions_data/CMS_COND_STRIP"
      string timetype = "runnumber"
      untracked string BlobStreamerName="DefaultBlobStreamingService"
      PSet DBParameters = {
        untracked string authenticationPath ="/afs/cern.ch/cms/DB/conddb"
        untracked int32 messageLevel = 0
	untracked uint32 authenticationMethod = 1
      }
    }

      # produce SiStripFecCabling and SiStripDetCabling out of SiStripFedCabling
      es_module sistripconn = SiStripConnectivity {}

    # > Digitization <
      # SiStripRaw2digi
      include "EventFilter/SiStripRawToDigi/data/SiStripDigis.cfi"

      # ZeroSuppressor
      include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression.cfi"

    # > Clusterization <
      # SiStripClusterizer
      include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_RealData.cfi"
      replace siStripClusters.ChannelThreshold    = 3.0
      replace siStripClusters.SeedThreshold       = 4.0
      replace siStripClusters.ClusterThreshold    = 7.0

      # SiStripClusterInfoProducer
      include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterInfoProducer.cfi"

    # > DQM <
      # Trigger
      module trigger = MTCCHLTrigger {
	bool    SelOnDigiCharge = false
        # threshold must be larger for collisions (23000 or so for 156 modules selected)
	int32   ChargeThreshold = 180 
	string  ClusterProducer = "siStripClusters"
      }

      # prescaler module
      module Prescaler = Prescaler{ 
	int32 prescaleFactor = 1
      }

      # SiStripMonitorDigi
      include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_RealData.cfi"
      # use the following flag to select all detectors (e.g. for mtcc data). by default is false
      # replace SiStripMonitorDigi.SelectAllDetectors = true
      replace SiStripMonitorDigi.SelectAllDetectors  = true
      replace SiStripMonitorDigi.DigiProducersList = {
             { 
	       string DigiProducer = "SiStripDigis"
               string DigiLabel    = "ZeroSuppressed"
             },
             { 
	       string DigiProducer = "siStripZeroSuppression"
               string DigiLabel    = "VirginRaw"
             },
             { 
	       string DigiProducer = "siStripZeroSuppression"
               string DigiLabel    = "ProcessedRaw"
             },
             { 
	       string DigiProducer = "siStripZeroSuppression"
               string DigiLabel    = "ScopeMode"
             }
      }

      # SiStripMonitorCluster
      include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
      # use the following flag to select all detectors (e.g. for mtcc data). by default is false
      replace SiStripMonitorCluster.SelectAllDetectors  = true
      replace SiStripMonitorCluster.UseCalibDataFromDB  = false # this is for the noise service
      replace SiStripMonitorCluster.OutputMEsInRootFile = true

      # Trigger Monitoring, SiStripMonitorHLT
      include "DQM/SiStripMonitorCluster/data/SiStripMonitorHLT.cfi"

      # SiStripOfflineDQM
      include "DQM/SiStripMonitorClient/data/SiStripOfflineDQM.cfi"
      replace modSiStripOfflineDQM.bOutputMEsInRootFile = true
      replace modSiStripOfflineDQM.bVerbose             = true

      # DQM services
      service = DaqMonitorROOTBackEnd{}

    # > Output <
      # cluster reconstruction ouptput module
      module out = PoolOutputModule {
	untracked string fileName = "OfflineDQM_tac_tob_v3_out.root"
	untracked vstring outputCommands = {
	  "keep *"
	}
      }
  # End Modules Configuration
  #=========================================================================================

  #=========================================================================================
  # Schedule
    sequence seqDigitization   = { 
      SiStripDigis,
      siStripZeroSuppression
    }
    sequence seqClusterization = { 
      siStripClusters,
      siStripClusterInfoProducer 
    }
    sequence seqDQM            = { 
      trigger,
      Prescaler,
      SiStripMonitorDigi,
      SiStripMonitorCluster 
    }
    sequence seqOfflineDQM     = { 
      seqDQM, 
      modSiStripOfflineDQM & SiStripMonitorHLT
    }

    path pDigisClustersClusterInfos = {
      seqDigitization,
      seqClusterization,
      seqOfflineDQM
    }

    # SAVE ALL events in pool file:
    endpath e1 = { out}
  # End Schedule
  #=========================================================================================
}
