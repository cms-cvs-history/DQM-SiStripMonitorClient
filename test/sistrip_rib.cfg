process TIFDQMSOURCES = {

  service = MessageLogger {
      untracked vstring destinations = { "cout" }
      untracked PSet cout = { untracked string threshold = "INFO" }
      untracked vstring debugModules   = { "SiStripZeroSuppression", "SiStripClusterizer"}
  }

service = AdaptorConfig {}
#include 
#    source = NewEventStreamFileReader {
#                untracked vstring fileNames = {
#    '/store/data/DaqTest/A/000/027/630/DaqTest.00027630.0001.A.storageManager.0.0000.dat',
#    '/store/data/DaqTest/A/000/027/630/DaqTest.00027630.0002.A.storageManager.0.0000.dat',
#    '/store/data/DaqTest/A/000/027/630/DaqTest.00027630.0003.A.storageManager.0.0000.dat'
#               }
#         }
   source = PoolSource {
          	untracked vstring fileNames = {
  'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/029/321/RAW/0000/9CE3D08D-E69D-DC11-AAEC-001617DBD272.root'
                }
   }
  untracked PSet maxEvents = {untracked int32 input = -1}
  # magnetic field
  # include "Geometry/CMSCommonData/data/cmsMagneticFieldXML.cfi"
  include "MagneticField/Engine/data/uniformMagneticField.cfi"
  replace UniformMagneticFieldESProducer.ZFieldInTesla = 0.0
  es_prefer = UniformMagneticFieldESProducer{}

  # tracker geometry
  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
 
  # tracker numbering
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
 
  # cms geometry
  include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"


  #-------------------------------------------------
  ## CALIBRATION 
  #-------------------------------------------------
  #### Fake Cabling #####
#    es_source = SiStripFedCablingFakeESSource {
#        FileInPath DetIdsFile = "DQM/SiStripMonitorClient/data/SiStripDetInfo_rib.dat"
#        FileInPath FedIdsFile = "DQM/SiStripMonitorClient/data/SiStripFedIdList_rib.dat"
#    }
#    include "CalibTracker/Configuration/data/SiStrip_FakePedestals.cfi"
#    include "CalibTracker/Configuration/data/SiStrip_FakeNoise.cfi"


  #### Real  Cabling #####
  es_source = PoolDBESSource {
    VPSet toGet = {
      { string record = "SiStripPedestalsRcd" string tag = "SiStripPedestals_GREN_v1" },
      { string record = "SiStripNoisesRcd" string tag = "SiStripNoise_GREN_v1" },
      { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_GREN_v1" }
    }
    string connect = "oracle://orcon/CMS_COND_ON_170_STRIP"       
    #string connect = "sqlite_file:dbfile.db"
    string timetype = "runnumber"
    untracked string BlobStreamerName="TBufferBlobStreamingService"
    PSet DBParameters = {
       untracked string authenticationPath="/afs/cern.ch/cms/DB/conddb"
       untracked int32 messageLevel=2
    }
  }
  include "CalibTracker/Configuration/data/SiStrip_FakeGain.cfi"

   # produce SiStripFecCabling and SiStripDetCabling out of SiStripFedCabling
   es_module sistripconn = SiStripConnectivity {}

    #-----------------------
    ####  Reconstruction Modules
    #-----------------------

    include "EventFilter/SiStripRawToDigi/data/SiStripDigis.cfi"
    replace SiStripDigis.ProductLabel="source"

    include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression.cfi"

    include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_RealData.cfi"

    include "AnalysisAlgos/SiStripClusterInfoProducer/data/SiStripClusterInfoProducer.cfi"

    include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"

    #--------------------------
    #### DQM
    #--------------------------
    # DQM services
    include "DQMServices/Core/data/DQM.cfg"

    #### MonitorPedestal ####
    # SiStripMonitorPedestals
    include "DQM/SiStripMonitorPedestals/data/SiStripMonitorPedestals.cfi"
    replace PedsMon.OutputMEsInRootFile = false

    #### SiStripMonitorDigi ####
    include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_RealData.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
    replace SiStripMonitorDigi.SelectAllDetectors = true

    #### SiStripMonitorCluster ####
    include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
    replace SiStripMonitorCluster.FillSignalNoiseHistos = false
    replace SiStripMonitorCluster.OutputMEsInRootFile = false
    replace SiStripMonitorCluster.SelectAllDetectors = true

    ####  SiStripMonitorAnalyser) ####
    module sistripAnalyser = SiStripAnalyser {
      untracked int32  StaticUpdateFrequency = -1
      untracked int32  TkMapCreationFrequency = -1
      untracked int32  SummaryCreationFrequency = 5
    }

    #### BEGIN DQM Online Environment #####
    # use include file for dqmEnv dqmSaver
    include "DQMServices/Components/test/dqm_onlineEnv.cfi"
    # put your subsystem name here: 
    # DT, Ecal, Hcal, SiStrip, Pixel, RPC, CSC, L1T 
    # (this goes into the filename)
    replace dqmSaver.fileName = "SiStrip"
    replace dqmSaver.dirName       = "."
    # (this goes into the foldername)
    replace dqmEnv.subSystemFolder = "SiStrip"

    # optionally change fileSaving  conditions
    # replace dqmSaver.prescaleLS =   -1
    # replace dqmSaver.prescaleTime = -1 # in minutes
    # replace dqmSaver.prescaleEvt =  -1
    replace dqmSaver.saveAtRunEnd = true
    # replace dqmSaver.saveAtJobEnd = false
    # will add switch to select histograms to be saved soon
   

   service = ModuleWebRegistry { }


   service = LockService {
     untracked vstring labels = { "source" }
   }
  #----------------------------
  #### Scheduling
  #-----------------------------

  sequence digitization   = {SiStripDigis,siStripZeroSuppression}
  sequence clusterization = {siStripClusters}

  path p = {digitization, clusterization, PedsMon, SiStripMonitorDigi, SiStripMonitorCluster, sistripAnalyser, dqmEnv, dqmSaver }     

}
