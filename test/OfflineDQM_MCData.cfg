process SISTRIPDQMDIGISCLUSTERS = {

  # MessageLogger service
  include "FWCore/MessageLogger/data/MessageLogger.cfi"

  service = LockService {
    untracked vstring labels = { "source" }
  }

  #=========================================================================================
  # Geometry
   include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"
   include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

   # magn. field
   include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

   # required for Pixel and SiStrip Digitizers
   include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
  # End Geometry
  #=========================================================================================

  #=========================================================================================
  # Sources
    # source of simulated hits
    source = PoolSource
    {
      untracked vstring fileNames	    = {"file:FlatPtSimHits.root"}
      untracked uint32  debugVebosity = 1
      untracked bool    debugFlag     = true
    }
    untracked PSet maxEvents = {untracked int32 input = -1}
  # End Sources
  #=========================================================================================

  #=========================================================================================
  # Modules Configuration
    # SiStripDigitizer
    include "SimTracker/SiStripDigitizer/data/SiStripDigi.cfi"

    # include SiStripClusterizer
    include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer.cfi"

    # mixing module
    include "DQM/SiStripMonitorCluster/data/MixingModule.cfi"

    # SiStripMonitorDigi
    include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_SimData.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
    # replace SiStripMonitorDigi.SelectAllDetectors = true
    replace SiStripMonitorDigi.OutputMEsInRootFile = false

    # SiStripMonitorClusterTest
    include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
    # replace SiStripMonitorCluster.SelectAllDetectors = true
    # Save/Don't save histograms in output file. Value is boolean: true/false. See SiStripMonitorCluster::endJob
    # for details.
    replace SiStripMonitorCluster.UseCalibDataFromDB  = false # this is for the noise service
    replace SiStripMonitorCluster.OutputMEsInRootFile = false

    # can comment out MonitorDeamon if you want to run without DQMCollector - this should go as include in DQMServices
    # include "DQM/SiStripMonitorCluster/data/MonitorDaemon.cfi"
    # replace MonitorDaemon.DestinationAddress = "cmswn064.fnal.gov"
    # replace MonitorDaemon.SendPort = 9090

    # Trigger
    module trigger = MTCCHLTrigger
    {
      bool    SelOnDigiCharge = false
      int32   ChargeThreshold = 180 # threshold must be larger for collisions (23000 or so for 156 modules selected)
      string  ClusterProducer = "siStripClusters"
    }

    # Trigger Monitoring, SiStripMonitorHLT
    include "DQM/SiStripMonitorCluster/data/SiStripMonitorHLT.cfi"
    replace SiStripMonitorHLT.OutputMEsInRootFile = false

    # SiStripOfflineDQM
    include "DQM/SiStripMonitorClient/data/SiStripOfflineDQM.cfi"
    replace SiStripOfflineDQM.bOutputMEsInRootFile = true

    # prescaler module
    module Prescaler = Prescaler{ 
      int32 prescaleFactor = 1
    }
  # End Modules Configuration
  #=========================================================================================


    # get SiStripFedCabling from sqlite_file

  es_source = PoolDBESSource {
     VPSet toGet = {
#       { string record = "SiStripPedestalsRcd" string tag = "SiStripPedNoise_TIBTOB_v1_p"},
       { string record = "SiStripNoisesRcd" string tag = "SiStripPedNoise_TIBTOB_v1_n"},
       { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_TIBTOB_v1"}}

     string connect = "sqlite_file:sistripfedcabling.db"
     string timetype = "runnumber"
     untracked string BlobStreamerName="DefaultBlobStreamingService"

     PSet DBParameters ={
       untracked string authenticationPath = "/afs/cern.ch/cms/DB/conddb"
       untracked uint32 authenticationMethod = 1
       untracked uint32 messagelevel	    = 10
     }
  }

    # produce SiStripFecCabling and SiStripDetCabling out of SiStripFedCabling
    es_module sistripconn = SiStripConnectivity {}

    # DQM services
    service = DaqMonitorROOTBackEnd{}

  #=========================================================================================
  # Schedule
    # reconstruction
    path pdigitize_clusterize    = {mix,siStripDigis,siStripClusters}
    # digi and cluster monitoring only the ones that pass the hlt
    path pdqm                    = {trigger,Prescaler,SiStripMonitorDigi,SiStripMonitorCluster,SiStripOfflineDQM}
    # monitor for every event the trigger decision
    path phltdqm                 = {SiStripMonitorHLT}
  # End Schedule
  #=========================================================================================
}
